"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.lambdaCommand = void 0;
const studio_server_1 = require("@remotion/studio-server");
const log_1 = require("./log");
const lambdaCommand = async (remotionRoot, args, logLevel) => {
    try {
        const path = require.resolve('@remotion/lambda', {
            paths: [remotionRoot],
        });
        const { LambdaInternals } = require(path);
        await LambdaInternals.executeCommand(args, remotionRoot, logLevel, null, null);
        process.exit(0);
    }
    catch (err) {
        const manager = studio_server_1.StudioServerInternals.getPackageManager(remotionRoot, undefined, 0);
        const installCommand = manager === 'unknown' ? 'npm i' : manager.installCommand;
        log_1.Log.error({ indent: false, logLevel }, err);
        log_1.Log.error({ indent: false, logLevel }, 'Remotion Lambda is not installed.');
        log_1.Log.info({ indent: false, logLevel }, '');
        log_1.Log.info({ indent: false, logLevel }, 'You can install it using:');
        log_1.Log.info({ indent: false, logLevel }, `${installCommand} @remotion/lambda@${studio_server_1.StudioServerInternals.getRemotionVersion()}`);
        process.exit(1);
    }
};
exports.lambdaCommand = lambdaCommand;
