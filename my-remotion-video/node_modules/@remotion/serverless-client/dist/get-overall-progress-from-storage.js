"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getOverallProgressFromStorage = void 0;
const constants_1 = require("./constants");
const stream_to_string_1 = require("./stream-to-string");
const getOverallProgressFromStorage = async ({ renderId, bucketName, expectedBucketOwner, region, providerSpecifics, forcePathStyle, requestHandler, }) => {
    try {
        const Body = await providerSpecifics.readFile({
            bucketName,
            key: (0, constants_1.overallProgressKey)(renderId),
            expectedBucketOwner,
            region,
            forcePathStyle,
            requestHandler,
        });
        const str = await (0, stream_to_string_1.streamToString)(Body);
        return JSON.parse(str);
    }
    catch (err) {
        if (err.name === 'NotFound') {
            throw new TypeError(`No render with ID "${renderId}" found in bucket ${bucketName} and region ${region}`);
        }
        throw err;
    }
};
exports.getOverallProgressFromStorage = getOverallProgressFromStorage;
