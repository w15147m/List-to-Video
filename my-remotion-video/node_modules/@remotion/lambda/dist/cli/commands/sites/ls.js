"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.sitesLsSubcommand = exports.SITES_LS_SUBCOMMAND = void 0;
const cli_1 = require("@remotion/cli");
const lambda_client_1 = require("@remotion/lambda-client");
const get_aws_region_1 = require("../../get-aws-region");
const date_string_1 = require("../../helpers/date-string");
exports.SITES_LS_SUBCOMMAND = 'ls';
const COLS = [20, 30, 10, 15];
const logRow = (data) => {
    return [
        data[0].padEnd(COLS[0], ' '),
        data[1].padEnd(COLS[1], ' '),
        data[2].padEnd(COLS[2], ' '),
        String(data[3]).padEnd(COLS[3], ' '),
    ].join('');
};
const sitesLsSubcommand = async (logLevel) => {
    const region = (0, get_aws_region_1.getAwsRegion)();
    const { sites, buckets } = await (0, lambda_client_1.getSites)({ region });
    if (buckets.length > 1 && !cli_1.CliInternals.quietFlagProvided()) {
        cli_1.CliInternals.Log.warn({ indent: false, logLevel }, 'Warning: You have more than one Remotion S3 bucket, but only one is needed. This can lead to conflicts. Remove all but one of them.');
    }
    const sitesPluralized = sites.length === 1 ? 'site' : 'sites';
    if (!cli_1.CliInternals.quietFlagProvided()) {
        cli_1.CliInternals.Log.info({ indent: false, logLevel }, `${sites.length} ${sitesPluralized} in the ${region} region.`);
    }
    if (cli_1.CliInternals.quietFlagProvided()) {
        if (sites.length === 0) {
            cli_1.CliInternals.Log.info({ indent: false, logLevel }, '()');
            return;
        }
        return cli_1.CliInternals.Log.info({ indent: false, logLevel }, sites.map((s) => s.id).join(' '));
    }
    cli_1.CliInternals.Log.info({ indent: false, logLevel });
    cli_1.CliInternals.Log.info({ indent: false, logLevel }, cli_1.CliInternals.chalk.gray(logRow(['Site Name', 'Bucket', 'Size', 'Last updated'])));
    for (const site of sites) {
        cli_1.CliInternals.Log.info({ indent: false, logLevel }, logRow([
            site.id,
            site.bucketName,
            cli_1.CliInternals.formatBytes(site.sizeInBytes),
            site.lastModified ? (0, date_string_1.dateString)(new Date(site.lastModified)) : 'n/a',
        ]));
        cli_1.CliInternals.Log.info({ indent: false, logLevel }, site.serveUrl);
        cli_1.CliInternals.Log.info({ indent: false, logLevel });
    }
};
exports.sitesLsSubcommand = sitesLsSubcommand;
