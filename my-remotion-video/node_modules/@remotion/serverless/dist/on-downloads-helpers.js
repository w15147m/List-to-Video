"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.onDownloadsHelper = void 0;
const renderer_1 = require("@remotion/renderer");
const onDownloadsHelper = (logLevel) => {
    const downloads = {};
    return (src) => {
        renderer_1.RenderInternals.Log.info({ indent: false, logLevel }, 'Downloading', src);
        downloads[src] = 0;
        return ({ percent, downloaded }) => {
            if (percent === null) {
                renderer_1.RenderInternals.Log.info({ indent: false, logLevel }, `Download progress (${src}): ${downloaded} bytes. Don't know final size of download, no Content-Length header.`);
                return;
            }
            if (
            // Only report every 10% change
            downloads[src] > percent - 0.1 &&
                percent !== 1) {
                return;
            }
            downloads[src] = percent;
            renderer_1.RenderInternals.Log.info({ indent: false, logLevel }, `Download progress (${src}): ${downloaded} bytes, ${(percent * 100).toFixed(1)}%`);
            if (percent === 1) {
                renderer_1.RenderInternals.Log.info({ indent: false, logLevel }, `Download complete: ${src}`);
            }
        };
    };
};
exports.onDownloadsHelper = onDownloadsHelper;
